<mvc:View controllerName="ns.gwsampleclient.controller.GWSample-Client"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:form="sap.ui.layout.form">
    <Page id="page" title="Sales Orders Management">
        <content>
            <Panel id="searchPanel" 
                   headerText="Filter Options" 
                   expandable="true" 
                   expanded="true"
                   class="sapUiResponsiveMargin">
                <content>
                    <VBox class="sapUiMediumMargin">
                        <form:SimpleForm layout="ResponsiveGridLayout"
                                       labelSpanXL="3" labelSpanL="3" labelSpanM="4" labelSpanS="12"
                                       adjustLabelSpan="false"
                                       emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0"
                                       columnsXL="2" columnsL="2" columnsM="1"
                                       singleContainerFullSize="false"
                                       breakpointXL="1440" breakpointL="1024" breakpointM="600">
                            <form:content>
                                <Label text="Order Number:"/>
                                <Input id="salesOrderInput" 
                                       value="{searchModel>/searchCriteria/salesOrderId}"
                                       showValueHelp="true"
                                       valueHelpRequest="onSalesOrderValueHelp"
                                       placeholder="Search by Order ID"
                                       width="100%"/>

                                <Label text="Customer Info:"/>
                                <Input id="customerInput" 
                                       value="{searchModel>/searchCriteria/customerName}"
                                       showValueHelp="true"
                                       valueHelpRequest="onCustomerValueHelp"
                                       placeholder="Search by Customer"
                                       width="100%"/>

                                <Label text="Product Info:"/>
                                <Input id="productInput" 
                                       value="{searchModel>/searchCriteria/productName}"
                                       showValueHelp="true"
                                       valueHelpRequest="onProductValueHelp"
                                       placeholder="Search by Product"
                                       width="100%"/>
                            </form:content>
                        </form:SimpleForm>

                        <HBox class="sapUiMediumMarginTop" 
                              wrap="Wrap" 
                              alignItems="Center"
                              justifyContent="Start">
                            <Button id="filterButton" 
                                    text="Apply Filter" 
                                    type="Emphasized"
                                    press="onSearch"
                                    icon="sap-icon://filter"
                                    class="sapUiSmallMarginEnd sapUiSmallMarginBottom"/>
                            <Button id="resetButton" 
                                    text="Reset All" 
                                    press="onClearSearch"
                                    icon="sap-icon://reset"
                                    class="sapUiSmallMarginBottom"/>
                        </HBox>
                    </VBox>
                </content>
            </Panel>

            <Panel id="groupingPanel" 
                   headerText="Grouping Options" 
                   expandable="true" 
                   expanded="true"
                   class="sapUiResponsiveMargin">
                <content>
                    <VBox class="sapUiMediumMargin">
                        <Label text="Group Sales Orders By:" class="sapUiSmallMarginBottom"/>
                        <HBox class="sapUiSmallMarginBottom" wrap="Wrap" alignItems="Center">
                            <ToggleButton id="deliveryGroupToggle"
                                        text="Delivery Status"
                                        pressed="true"
                                        press="onDeliveryGroupToggle"
                                        icon="sap-icon://shipping-status"
                                        class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <ToggleButton id="billingGroupToggle"
                                        text="Billing Status"
                                        pressed="false"
                                        press="onBillingGroupToggle"
                                        icon="sap-icon://sales-document"
                                        class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <Button id="clearGroupingButton"
                                   text="Clear Grouping"
                                   press="onClearGrouping"
                                   icon="sap-icon://clear-filter"
                                   type="Transparent"
                                   class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <Button id="groupStatsButton"
                                   text="Show Statistics"
                                   press="showGroupingStatistics"
                                   icon="sap-icon://pie-chart"
                                   type="Transparent"
                                   class="sapUiTinyMarginBottom"/>
                        </HBox>
                    </VBox>
                </content>
            </Panel>

            <!-- Responsive Table with proper column widths -->
            <Table id="mainSalesTable" 
                   items="{
						path: '/SalesOrderSet',
                        sorter: {path: 'DeliveryStatus'},
                        groupHeaderFactory: '.buildGroupHeader'  
					}"
                   class="sapUiResponsiveMargin"
                   mode="SingleSelect"
                   fixedLayout="false"
                   growing="true"
                   growingThreshold="50">

                <headerToolbar>
                    <Toolbar>
                        <Title text="Sales Order Overview" level="H2"/>
                        <ToolbarSpacer/>
                        <Text id="totalRecordsText" text=""/>
                    </Toolbar>
                </headerToolbar>

                <columns>
                    <Column width="12%" 
                            minScreenWidth="Tablet" 
                            demandPopin="true"
                            popinDisplay="Inline">
                        <Text text="Order ID"/>
                    </Column>
                    <Column width="25%" 
                            minScreenWidth="Phone" 
                            demandPopin="false">
                        <Text text="Customer"/>
                    </Column>
                    <Column width="15%" 
                            minScreenWidth="Tablet" 
                            demandPopin="true"
                            popinDisplay="Block"
                            hAlign="End">
                        <Text text="Total Amount"/>
                    </Column>
                    <Column width="13%" 
                            minScreenWidth="Desktop" 
                            demandPopin="true"
                            popinDisplay="Block"
                            hAlign="End">
                        <Text text="Net Value"/>
                    </Column>
                    <Column width="13%" 
                            minScreenWidth="Desktop" 
                            demandPopin="true"
                            popinDisplay="Block"
                            hAlign="End">
                        <Text text="Tax Value"/>
                    </Column>
                    <Column width="11%" 
                            minScreenWidth="Tablet" 
                            demandPopin="true"
                            popinDisplay="Inline">
                        <Text text="Invoice"/>
                    </Column>
                    <Column width="11%" 
                            minScreenWidth="Tablet" 
                            demandPopin="true"
                            popinDisplay="Inline">
                        <Text text="Delivery"/>
                    </Column>
                </columns>

                <items>
                    <ColumnListItem press="onOrderItemSelected" type="Navigation">
                        <cells>
                            <Text text="{SalesOrderID}" wrapping="false"/>
                            <VBox>
                                <Text text="{CustomerName}" 
                                      wrapping="true" 
                                      maxLines="2"/>
                                <Text text="ID: {CustomerID}" 
                                      class="sapUiTinyText"/>
                            </VBox>
                            <Text text="{parts: ['GrossAmount', 'CurrencyCode'], formatter: '.formatCurrency'}" 
                                  wrapping="false"
                                  textAlign="End"/>
                            <Text text="{parts: ['NetAmount', 'CurrencyCode'], formatter: '.formatCurrency'}" 
                                  wrapping="false"
                                  textAlign="End"/>
                            <Text text="{parts: ['TaxAmount', 'CurrencyCode'], formatter: '.formatCurrency'}" 
                                  wrapping="false"
                                  textAlign="End"/>
                            <Text text="{BillingStatusDescription}" 
                                  wrapping="true" 
                                  maxLines="2"/>
                            <Text text="{DeliveryStatusDescription}" 
                                  wrapping="true" 
                                  maxLines="2"/>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </content>
        <footer>
            <Toolbar>
                <ToolbarSpacer/>
                <Button id="dataRefreshButton" 
                        text="Refresh Data" 
                        type="Emphasized" 
                        press="onRegenerateData"
                        icon="sap-icon://synchronize"/>
            </Toolbar>
        </footer>
    </Page>

    <SelectDialog id="orderSelectionDialog"
                  title="Choose Sales Order"
                  search="onOrderDialogFilter"
                  confirm="onOrderDialogAccept"
                  cancel="onOrderDialogCancel"
                  items="{/SalesOrderSet}">
        <StandardListItem title="{SalesOrderID}"
                         description="{CustomerName} - {GrossAmount} {CurrencyCode}"
                         info="{LifecycleStatusDescription}"
                         type="Active"/>
    </SelectDialog>
    
    <SelectDialog id="customerSelectionDialog"
                  title="Choose Customer"
                  search="onCustomerDialogFilter"
                  confirm="onCustomerDialogAccept"
                  cancel="onCustomerDialogCancel"
                  items="{/BusinessPartnerSet}">
        <StandardListItem title="{CompanyName}"
                         description="{BusinessPartnerID}"
                         info="{EmailAddress}"
                         type="Active"/>
    </SelectDialog>

    <SelectDialog id="productSelectionDialog"
                  title="Choose Product"
                  search="onProductDialogFilter"
                  confirm="onProductDialogAccept"
                  cancel="onProductDialogCancel"
                  items="{/ProductSet}">
        <StandardListItem title="{Name}"
                         description="{ProductID} - {Category}"
                         info="{Price} {CurrencyCode}"
                         type="Active"/>
    </SelectDialog>

</mvc:View>